
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Ônibus - Transfer Logística</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #1a73e8; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input, select, button { margin: 5px; padding: 8px; }
    #searchContainer { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Controle de Ônibus - Transfer Logística</h1>

  <label>Prefixo:</label>
  <input type="text" id="prefixo" />
  <label>Motorista:</label>
  <input type="text" id="motorista" />
  <label>Entrada/Saída:</label>
  <select id="tipo">
    <option value="Entrada">Entrada</option>
    <option value="Saída">Saída</option>
  </select>
  <label>Hora:</label>
  <input type="time" id="hora" />
  <label>Observações:</label>
  <input type="text" id="obs" />
  <button onclick="adicionarRegistro()">Salvar</button>
  <button onclick="baixarExcel()">Baixar Excel</button>

  <div id="searchContainer">
    <input type="text" id="pesquisa" placeholder="Pesquisar por prefixo" oninput="pesquisarPrefixo()" />
  </div>

  <table id="tabela">
    <thead>
      <tr>
        <th>Prefixo</th>
        <th>Motorista</th>
        <th>Tipo</th>
        <th>Hora</th>
        <th>Observações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const tabela = document.querySelector("#tabela tbody");
    const STORAGE_KEY = "transfer_" + new Date().toISOString().slice(0, 10);

    function salvarLocalStorage(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function carregarRegistros() {
      const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      data.forEach(r => inserirNaTabela(r));
    }

    function adicionarRegistro() {
      const registro = {
        prefixo: document.getElementById("prefixo").value,
        motorista: document.getElementById("motorista").value,
        tipo: document.getElementById("tipo").value,
        hora: document.getElementById("hora").value,
        obs: document.getElementById("obs").value
      };
      inserirNaTabela(registro);
      const registros = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      registros.push(registro);
      salvarLocalStorage(registros);
      limparCampos();
    }

    function inserirNaTabela(registro) {
      const linha = tabela.insertRow();
      linha.insertCell(0).textContent = registro.prefixo;
      linha.insertCell(1).textContent = registro.motorista;
      linha.insertCell(2).textContent = registro.tipo;
      linha.insertCell(3).textContent = registro.hora;
      linha.insertCell(4).textContent = registro.obs;
    }

    function limparCampos() {
      document.getElementById("prefixo").value = "";
      document.getElementById("motorista").value = "";
      document.getElementById("hora").value = "";
      document.getElementById("obs").value = "";
    }

    function baixarExcel() {
      const wb = XLSX.utils.book_new();
      const registros = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      const ws = XLSX.utils.json_to_sheet(registros);
      XLSX.utils.book_append_sheet(wb, ws, "Registros");
      XLSX.writeFile(wb, STORAGE_KEY + ".xlsx");
    }

    function pesquisarPrefixo() {
      const termo = document.getElementById("pesquisa").value.toLowerCase();
      const linhas = tabela.getElementsByTagName("tr");
      for (let i = 0; i < linhas.length; i++) {
        const c = linhas[i].getElementsByTagName("td")[0];
        if (c) {
          const prefixo = c.textContent.toLowerCase();
          linhas[i].style.display = prefixo.includes(termo) ? "" : "none";
        }
      }
    }

    carregarRegistros();
  </script>
</body>
</html>
